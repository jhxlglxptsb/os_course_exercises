# lec6 SPOC思考题


NOTICE
- 有"w3l2"标记的题是助教要提交到学堂在线上的。
- 有"w3l2"和"spoc"标记的题是要求拿清华学分的同学要在实体课上完成，并按时提交到学生对应的git repo上。
- 有"hard"标记的题有一定难度，鼓励实现。
- 有"easy"标记的题很容易实现，鼓励实现。
- 有"midd"标记的题是一般水平，鼓励实现。

## 与视频相关思考题

### 6.1	非连续内存分配的需求背景
 1. 为什么要设计非连续内存分配机制？
 - 分配给程序的物理内存必须连续
 - 存在外碎片和内碎片
 - 内存分配动态修改困难
 - 内存利用率较低

 1. 非连续内存分配中内存分块大小有哪些可能的选择？大小与大小是否可变?
 - 可选择段式存储管理分配较大的内存块，或选择页式存储管理分配较小的内存块
 - 可变

 1. 为什么在大块时要设计大小可变，而在小块时要设计成固定大小？小块时的固定大小可以提供多种选择吗？
 - 大小可变会更灵活，但固定大小更便于管理
 - 可以

### 6.2	段式存储管理
 1. 什么是段、段基址和段内偏移？
 - 段表示访问方式和存储数据等属性相同的一段地址空间
 - 段基址是段的起始地址
 - 段内偏移是段中数据地址到段基址的距离


 1. 段式存储管理机制的地址转换流程是什么？为什么在段式存储管理中，各段的存储位置可以不连续？这种做法有什么好处和麻烦？
 - 首先得到断号和段内偏移，在段表中找到对应的基址和段长度，如果段内偏移不大于段长度，那么就用段基址加上段内偏移对应到物理地址，否则抛出内存异常
 - 因为段是逻辑地址空间，有段基址存储了每段不连续的地址的起始位置
 - 好处是可以不连续，便于内存管理，麻烦在于地址转换，还需要额外的段表和寄存器

### 6.3	页式存储管理
 1. 什么是页（page）、帧（frame）、页表（page table）、存储管理单元（MMU）、快表（TLB, Translation Lookaside Buffer）和高速缓存（cache）？
 - 页是把逻辑地址空间也划分为相同大小的基本分配单位
 - 帧是把物理地址空间划分为大小相同的基本分配单位
 - 页表是保存逻辑地址到物理地址之间的映射关系的表，即是存储了页与帧之间的映射
 - 存储管理单元是硬件层面上负责虚拟地址和物理地址之间的转换的结构
 - 快表是是存放在高速缓冲存储器的部分页表
 - 高速缓存是存在于主存与 CPU 之间的一级存储器
 
 1. 页式存储管理机制的地址转换流程是什么？为什么在页式存储管理中，各页的存储位置可以不连续？这种做法有什么好处和麻烦？
 - 首先得到页号和页内偏移，用页号在页表中找到对应的帧号，再利用帧号和页内偏移计算出物理地址
 - 逻辑地址是连续的，但逻辑地址所指向的物理地址可以不连续
 - 好处是可以不连续，麻烦在于地址转换，且频繁进行


### 6.4	页表概述
 1. 每个页表项有些什么内容？有哪些标志位？它们起什么作用？
 - 页表项包括帧号和标志位
 - 标志位包括修改位，存在位，引用位
 - 修改位记录是否被修改
 - 存在位记录是否存在对应的帧
 - 引用位记录页面是否有过对它的引用
 
 1. 页表大小受哪些因素影响？
 - 地址空间大小
 - 页大小
 - 进程数

### 6.5	快表和多级页表
 1. 快表（TLB）与高速缓存（cache）有什么不同？
 - 快表是缓存页表项，高速缓存缓存的是内存
 
 1. 为什么快表中查找物理地址的速度非常快？它是如何实现的？为什么它的的容量很小？
 - 因为它的位置是在CPU中，所以速度快
 - 实现方式是将近期访问的页表项缓存到CPU里面。每次访问时，如果没有命中，就将对应的表项更新到TLB中
 - 因为成本高、功耗大，所以容量小
 
 1. 什么是多级页表？多级页表中的地址转换流程是什么？多级页表有什么好处和麻烦？
 - 多级页表是通过间接引用将页号分成k级
 - 转换流程是，首先得到每一级页表的页号和页内偏移，然后先查找第一级页表，找到对应的下一级页表，这样依次下去，最终得到对应的帧号，然后计算出地址
 - 好处是减少了页表的存储空间，麻烦是使地址转换更复杂

### 6.6	反置页表
 1. 页寄存器机制的地址转换流程是什么？
 - 对逻辑地址进行hash变换
 - 在快表中查找对应的页表项
 - 有冲突时遍历冲突项链表
 - 查找失败时，产生异常
 
 1. 反置页表机制的地址转换流程是什么？
 - 逻辑地址与运行进程的PID共同进行hash，然后在反置页表中查找，如果发现进程ID与逻辑页号跟hash之前不一样，那么说明有冲突，需要再找下一项
 
 
 1. 反置页表项有些什么内容？
 - PID
 - 页号
 - 标志位

### 6.7	段页式存储管理
 1. 段页式存储管理机制的地址转换流程是什么？这种做法有什么好处和麻烦？
 - 首先用段号在段表中查找段基址，然后查找该段所对应的页表，计算出物理地址
 - 好处是可以通过指向相同的页表基址，实现进程间的段共享；有段机制对存储的保护，也有页机制对内存较高的利用效率。麻烦是增加了地址转换的复杂度
 
 1. 如何实现基于段式存储管理的内存共享？
 - 将共享段的段基址设置的一样即可
 
 1. 如何实现基于页式存储管理的内存共享？
 - 在页表中将它们映射到相同的帧
